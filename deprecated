


def save_selection_to_gif(gif_name, start=0, end=10, gif_delay=20, interval=1):
    # TODO: update method head to accept array
    print(f'constructing gif: {gif_name}.gif')
    scan = CtScan(start, end)
    font = ImageFont.truetype(font='usr/share/fonts/TTF/LiberationMono-Bold.ttf', size=35)

    print('generating subimages...')
    for i in range(0, end - start, interval):
        img = Image.fromarray(scan.data[i])
        draw = ImageDraw.Draw(img)
        draw.text((0, 0), str(start + i), 255, font=font)
        draw = ImageDraw.Draw(img)
        img.save(f"{settings.tempdir}{start + i}.png")

    print("collecting images to gif...")
    bash_command = f"convert -delay {gif_delay} {settings.tempdir}*.png {settings.imgdir}{gif_name}.gif"
    process = subprocess.Popen(bash_command.split(), stdout=subprocess.PIPE)
    output, error = process.communicate()

    # delete obsolete images
    print("deleting obsolete images...")
    for p in Path(settings.tempdir).glob("*.png"):
        p.unlink()
    print('done.')
